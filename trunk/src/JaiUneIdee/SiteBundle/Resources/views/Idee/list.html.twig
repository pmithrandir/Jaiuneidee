{% extends 'JaiUneIdeeSiteBundle::layout_1_col.html.twig' %}

{% import 'GloomyPagerBundle:Pager:macros.html.twig' as helper %}
{% block title %}Liste des id√©es{% endblock %}
{% datagrid_theme datagrid _self %}

{% block stylesheets %}
    {{ parent() }}
    {{ datagrid_stylesheets(datagrid) }}
{% endblock %}
{% block javascript %}
    {{ parent() }}
    {{ datagrid_javascripts(datagrid) }}

    <script src="/bundles/gloomypager/js/gloomy-utils.js" type="text/javascript"></script>

    <script src="{{ asset('js/tokeninput.js') }}"></script>
    <script language="javascript">
        
        updateDatagrid = function(url, data) {
            gloomyAjaxUpdater(
                    url, 
                    '#datagrid', 
                    {
                        spinner: '#loading', 
                        type: 'post', 
                        data: data, 
                        onsuccess: function() {
                            bindDatagrid(); 
                        }
                    }
            );
        }

        bindDatagrid = function() {
        	$('#datagrid form').submit(function(event) {
        		event.preventDefault();
            updateDatagrid($(this).attr('action'), $(this).serializeArray());
        		return false;
        		});
    		
        	$('#datagrid .btn-group a:not(.outbound, [href^="#"])').on(
                    'click',
                    function(event) {
                        event.preventDefault();
                        updateDatagrid(this.href);
                    }
                );
          $('#datagrid .pagination a:not(.outbound, [href^="#"])').on(
                        'click',
                        function(event) {
                            event.preventDefault();
                            updateDatagrid(this.href);
                        }
                    );
          if($(".tokeninput_unique_datagrid").length){
	      		$(".tokeninput_unique_datagrid").tokenInput("../localisation_list", {
	                  theme: "facebook",
	                  propertyToSearch: "nom",
	                  minChars: 3,
	                  tokenLimit: 1,
	                  preventDuplicates: true,
	                  prePopulate: (typeof(datas) != 'undefined')?datas:null,
	    	            onAdd: function() {
	    	            		$('#datagrid form').submit()
		    	          },
			  	          onDelete: function() {
			          			$('#datagrid form').submit()
				          	}
	              });
	      	}
        };

        jQuery(document).ready(function() {
            bindDatagrid();
        });
    </script>
{% endblock %}

{% block mainCol %}
        <span id="loading" style="color: orange; position:absolute; width:100px; height:30px; left:48%; top:30%;border:1px solid black; background-color:white; display: none;text-align:center; line-height:30px;">
            Loading...
        </span>
        <div id="datagrid">
					{#
					{{ datagrid(datagrid) }}
					#}
					{% include 'JaiUneIdeeSiteBundle:Idee:datagrid.html.twig' with {'datagrid': datagrid} %}
				</div>
{% endblock %}
